schema: '2.0'
stages:
  convert_asr_model_to_onnx:
    cmd: python src/stages/convert_asr_model_to_onnx.py --config=params.yaml
    params:
      params.yaml:
        base:
          random_state: 42
          sample_size: 0.05
        convert_asr_model:
          input_model_path_or_id: facebook/wav2vec2-base-960h
          output_model_path: models/asr_model.onnx
    outs:
    - path: models/asr_model.onnx
      hash: md5
      md5: a8ab2f2d5934583599f2af094f39bdbd
      size: 377887547
  convert_nlu_model_to_onnx:
    cmd: python src/stages/convert_nlu_model_to_onnx.py --config=params.yaml
    params:
      params.yaml:
        base:
          random_state: 42
          sample_size: 0.05
        convert_nlu_model:
          input_model_path_or_id: sankar1535/slurp-intent_baseline-distilbert-base-uncased
          output_model_path: models/nlu_model.onnx
    outs:
    - path: models/nlu_model.onnx
      hash: md5
      md5: 70a1a632e7fa3c2729023a03e9c2daf8
      size: 268232555
  preprocess_dataset:
    cmd: python src/stages/preprocess_dataset.py --config=params.yaml
    deps:
    - path: data/slurp_dataset
      hash: md5
      md5: 0fbe0c8c7db276a7359068ba2ddf2e13.dir
      size: 3977096200
      nfiles: 7
    params:
      params.yaml:
        base:
          random_state: 42
          sample_size: 0.05
        data_preprocessing:
          tarfile_dataset_fpath: data/slurp_dataset/audio/slurp_real.tar.gz
          extract_to: data/slurp_dataset/audio
          dev_recordings_metadata_fpath: data/slurp_dataset/slurp/devel.jsonl
          recordings_dir: data/slurp_dataset/audio/slurp_real
          output_fpath: data/preprocessed_dataset.csv
    outs:
    - path: data/preprocessed_dataset.csv
      hash: md5
      md5: 21e8ebc1c8798a19f9c3f2ba12a36ee9
      size: 11753
  asr_inference:
    cmd: python src/stages/run_asr_model.py --config=params.yaml
    deps:
    - path: models/asr_model.onnx
      hash: md5
      md5: a8ab2f2d5934583599f2af094f39bdbd
      size: 377887547
    params:
      params.yaml:
        asr_inference:
          output_fpath: data/asr_predictions.csv
        base:
          random_state: 42
          sample_size: 0.05
        convert_asr_model:
          input_model_path_or_id: facebook/wav2vec2-base-960h
          output_model_path: models/asr_model.onnx
        data_preprocessing:
          tarfile_dataset_fpath: data/slurp_dataset/audio/slurp_real.tar.gz
          extract_to: data/slurp_dataset/audio
          dev_recordings_metadata_fpath: data/slurp_dataset/slurp/devel.jsonl
          recordings_dir: data/slurp_dataset/audio/slurp_real
          output_fpath: data/preprocessed_dataset.csv
    outs:
    - path: data/asr_predictions.csv
      hash: md5
      md5: cd7578e61283ee1545c331fab52ce739
      size: 4176
  nlu_model:
    cmd: python src/stages/run_nlu_model.py --config=params.yaml
    deps:
    - path: models/nlu_model.onnx
      hash: md5
      md5: 70a1a632e7fa3c2729023a03e9c2daf8
      size: 268232555
    params:
      params.yaml:
        asr_inference:
          output_fpath: data/asr_predictions.csv
        base:
          random_state: 42
          sample_size: 0.05
        convert_nlu_model:
          input_model_path_or_id: sankar1535/slurp-intent_baseline-distilbert-base-uncased
          output_model_path: models/nlu_model.onnx
        data_preprocessing:
          tarfile_dataset_fpath: data/slurp_dataset/audio/slurp_real.tar.gz
          extract_to: data/slurp_dataset/audio
          dev_recordings_metadata_fpath: data/slurp_dataset/slurp/devel.jsonl
          recordings_dir: data/slurp_dataset/audio/slurp_real
          output_fpath: data/preprocessed_dataset.csv
    outs:
    - path: data/nlu_predictions.csv
      hash: md5
      md5: 4703aebbcf846bc31a8038eae594c3cd
      size: 2216
  evaluation:
    cmd: python src/stages/evaluation.py --config=params.yaml
    deps:
    - path: data/nlu_predictions.csv
      hash: md5
      md5: 4703aebbcf846bc31a8038eae594c3cd
      size: 2216
    - path: data/preprocessed_dataset.csv
      hash: md5
      md5: 21e8ebc1c8798a19f9c3f2ba12a36ee9
      size: 11753
    params:
      params.yaml:
        asr_inference:
          output_fpath: data/asr_predictions.csv
        base:
          random_state: 42
          sample_size: 0.05
        convert_asr_model:
          input_model_path_or_id: facebook/wav2vec2-base-960h
          output_model_path: models/asr_model.onnx
        convert_nlu_model:
          input_model_path_or_id: sankar1535/slurp-intent_baseline-distilbert-base-uncased
          output_model_path: models/nlu_model.onnx
        data_preprocessing:
          tarfile_dataset_fpath: data/slurp_dataset/audio/slurp_real.tar.gz
          extract_to: data/slurp_dataset/audio
          dev_recordings_metadata_fpath: data/slurp_dataset/slurp/devel.jsonl
          recordings_dir: data/slurp_dataset/audio/slurp_real
          output_fpath: data/preprocessed_dataset.csv
        nlu_inference:
          output_fpath: data/nlu_predictions.csv
    outs:
    - path: metrics/metrics.json
      hash: md5
      md5: 63aa590c338259a8d3c796838c31681d
      size: 34
